<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="manifest" href="../manifest.webmanifest"><title>Pop Bubbles</title><link rel="stylesheet" href="../styles.css"/><script defer src="../js/common.js"></script></head><body>
<header class="header"><div class="bar container"><div class="brand"><span class="dot"></span> Toddler Play</div><div class="spacer"></div><a class="button" href="sensory.html">â¬… Back</a></div></header>
<main class="container"><div class="breadcrumb"><a href="../index.html">Home</a> â€º <a href="sensory.html">Sensory Play</a> â€º Pop Bubbles</div><h1>ðŸ«§ Pop Bubbles</h1>
<div class="tile" id="play" style="height:68vh; margin-top:14px"></div></main>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  App.init();
  const el=document.getElementById("play");
  const c=document.createElement("canvas"); const DPR=Math.max(1, devicePixelRatio||1);
  const ctx=c.getContext("2d");
  function size(){ c.width=Math.max(1, el.clientWidth*DPR); c.height=Math.max(1, el.clientHeight*DPR); c.style.width="100%"; c.style.height="100%"; }
  size(); addEventListener("resize", size); el.appendChild(c);

  let bubbles=[];
  function add(n=6){
    for(let i=0;i<n;i++){
      bubbles.push({x:Math.random()*c.width, y:c.height+Math.random()*200, r:(30+Math.random()*60)*DPR, v:(0.6+Math.random()*1.2)*DPR, hue:Math.floor(Math.random()*360), a:0.9});
    }
  }
  function draw(){
    ctx.clearRect(0,0,c.width,c.height);
    for(const b of bubbles){
      b.y -= b.v;
      const g=ctx.createRadialGradient(b.x,b.y,b.r*0.1,b.x,b.y,b.r);
      g.addColorStop(0,`hsla(${b.hue},90%,70%,${b.a})`);
      g.addColorStop(1,`hsla(${(b.hue+40)%360},80%,40%,${b.a*0.6})`);
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
    }
    bubbles = bubbles.filter(b => b.y + b.r > 0);
    if (bubbles.length < 16) add(4);
    requestAnimationFrame(draw);
  }
  add(16); draw();

  function hit(clientX, clientY){
    const r=c.getBoundingClientRect();
    const mx = (clientX - r.left) * DPR;
    const my = (clientY - r.top) * DPR;
    for(let i=bubbles.length-1;i>=0;i--){
      const b=bubbles[i]; const dx=b.x-mx, dy=b.y-my;
      if (dx*dx + dy*dy <= b.r*b.r){
        bubbles.splice(i,1);
        App.pop(); App.softBurst(clientX, clientY);
        return true;
      }
    }
    return false;
  }

  c.addEventListener("pointerdown", (e)=>{
    hit(e.clientX, e.clientY);
  });
  // support multi-touch
  c.addEventListener("touchstart", (e)=>{
    const r=c.getBoundingClientRect();
    for(const t of e.touches){
      hit(t.clientX, t.clientY);
    }
  }, {passive:true});
});
</script>

</body></html>
